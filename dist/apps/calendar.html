<!DOCTYPE html>
<html lang="en">

<head>

  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Meta -->
  <meta name="description" content="Fut 7 - Montessori">
  <meta name="author" content="Fut 7 - Montessori">

  <!-- Favicon -->
  <link rel="shortcut icon" type="image/x-icon" href="../assets/img/favicon.ico">

  <title>Fut 7 - Montessori</title>

  <!-- Vendor CSS -->
  <link rel="stylesheet" href="../lib/remixicon/fonts/remixicon.css">
  <link rel="stylesheet" href="../lib/fullcalendar/main.min.css">

  <!-- Template CSS -->
  <link rel="stylesheet" href="../assets/css/style.min.css">

  <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css"> -->
  <script src="https://js.stripe.com/v3/"></script>
</head>

<body class="app-calendar sidebar-offset">

  <div class="sidebar">
    <div class="sidebar-header">
      <a href="#" class="sidebar-logo">FUT7</a>
    </div><!-- sidebar-header -->
    <div id="sidebarMenu" class="sidebar-body">
      <div class="nav-group"> </div><!-- nav-group -->
      <div class="nav-group show">
        <ul class="nav nav-sidebar">
          <li class="nav-item">
            <a href="#" class="nav-link active"><i class="ri-calendar-fill"></i> <span>Calendario Rentas</span></a>
          </li>
          <li class="nav-item">
            <a href="../apps/chat.html" class="nav-link"><i class="ri-question-answer-line"></i> <span>Chat</span></a>
          </li>
          <li class="nav-item"></li>
          <a href="../pages/faq.html" class="nav-link"><i class="ri-file-text-line"></i> <span>Reglamento</span></a>
          </li>
          <li class="nav-item"></li>
          <a href="../pages/privacypolicies.html" class="nav-link"><i class="ri-file-text-line"></i> <span>Políticas de
              Privacidad</span></a>
          </li>
        </ul>
      </div><!-- nav-group -->
      <div class="nav-group">

      </div><!-- nav-group -->
      <div class="nav-group mb-3">

      </div><!-- nav-group -->
    </div><!-- sidebar-body -->
    <div class="sidebar-footer">
      <div class="sidebar-footer-top">
        <div class="sidebar-footer-thumb">
          <img src="../assets/img/img1.jpg" alt="">
        </div><!-- sidebar-footer-thumb -->
        <div class="sidebar-footer-body">
          <h6><a href="../pages/profile.html">Usuario</a></h6>
        </div><!-- sidebar-footer-body -->
        <a id="sidebarFooterMenu" href="" class="dropdown-link"><i class="ri-arrow-down-s-line"></i></a>
      </div><!-- sidebar-footer-top -->
      <div class="sidebar-footer-menu">
        <nav class="nav">
          <a href="../pages/profile.html"><i class="ri-edit-2-line"></i>Perfil</a>
        </nav>
        <hr>
        <nav class="nav">
          <a href="../pages/sign-in.html"><i class="ri-logout-box-r-line"></i> Cerrar Sesion</a>
        </nav>
      </div><!-- sidebar-footer-menu -->
    </div><!-- sidebar-footer -->
  </div><!-- sidebar -->

  <div class="header-main px-3 px-lg-4">
    <a id="menuSidebarOffset" href="#" class="menu-link me-3 me-lg-4"><i class="ri-menu-2-fill"></i></a>
    <div class="me-auto">

    </div><!-- form-search -->

    <div class="dropdown dropdown-skin">
      <a href="" class="dropdown-link" data-bs-toggle="dropdown" data-bs-auto-close="outside"><i
          class="ri-settings-3-line"></i></a>
      <div class="dropdown-menu dropdown-menu-end mt-10-f">
        <label>Skin Mode</label>
        <nav id="skinMode" class="nav nav-skin">
          <a href="" class="nav-link active">Light</a>
          <a href="" class="nav-link">Dark</a>
        </nav>
      </div><!-- dropdown-menu -->
    </div><!-- dropdown -->

    <div class="dropdown dropdown-notification ms-3 ms-xl-4">
      <a href="" class="dropdown-link" data-bs-toggle="dropdown" data-bs-auto-close="outside"><small>3</small><i
          class="ri-notification-3-line"></i></a>
      <div class="dropdown-menu dropdown-menu-end mt-10-f me--10-f">
        <div class="dropdown-menu-header">
          <h6 class="dropdown-menu-title">Notifications</h6>
        </div><!-- dropdown-menu-header -->
        <ul class="list-group">
          <li class="list-group-item">
            <div class="avatar online"><img src="../assets/img/img10.jpg" alt=""></div>
            <div class="list-group-body">
              <p><strong>Dominador Manuel</strong> and <strong>100 other people</strong> reacted to your comment "Tell
                your partner that...</p>
              <span>Aug 20 08:55am</span>
            </div><!-- list-group-body -->
          </li>
          <li class="list-group-item">
            <div class="avatar online"><img src="../assets/img/img11.jpg" alt=""></div>
            <div class="list-group-body">
              <p><strong>Angela Ighot</strong> tagged you and <strong>9 others</strong> in a post.</p>
              <span>Aug 18 10:30am</span>
            </div><!-- list-group-body -->
          </li>
          <li class="list-group-item">
            <div class="avatar"><span class="avatar-initial bg-primary">a</span></div>
            <div class="list-group-body">
              <p>New listings were added that match your search alert <strong>house for rent</strong></p>
              <span>Aug 15 08:10pm</span>
            </div><!-- list-group-body -->
          </li>
          <li class="list-group-item">
            <div class="avatar online"><img src="../assets/img/img14.jpg" alt=""></div>
            <div class="list-group-body">
              <p>Reminder: <strong>Jerry Cuares</strong> invited you to like <strong>Cuares Surveying Services</strong>.
                <br><a href="">Accept</a> or <a href="">Decline</a>
              </p>
              <span>Aug 14 11:50pm</span>
            </div><!-- list-group-body -->
          </li>
          <li class="list-group-item">
            <div class="avatar online"><img src="../assets/img/img15.jpg" alt=""></div>
            <div class="list-group-body">
              <p><strong>Dyanne Aceron</strong> reacted to your post <strong>King of the Bed</strong>.</p>
              <span>Aug 10 05:30am</span>
            </div><!-- list-group-body -->
          </li>
        </ul>
        <div class="dropdown-menu-footer"><a href="">Show all Notifications</a></div>
      </div><!-- dropdown-menu -->
    </div><!-- dropdown -->
    <div class="dropdown dropdown-profile ms-3 ms-xl-4">
      <a href="" class="dropdown-link" data-bs-toggle="dropdown" data-bs-auto-close="outside">
        <div class="avatar online"><img src="../assets/img/img1.jpg" alt=""></div>
      </a>
      <div class="dropdown-menu dropdown-menu-end mt-10-f">
        <div class="dropdown-menu-body">
          <div class="avatar avatar-xl online mb-3"><img src="../assets/img/img1.jpg" alt=""></div>
          <h5 class="mb-1 text-dark fw-semibold">Shaira Diaz</h5>
          <p class="fs-sm text-secondary">Premium Member</p>

          <nav class="nav">
            <a href=""><i class="ri-edit-2-line"></i> Edit Profile</a>
            <a href=""><i class="ri-profile-line"></i> View Profile</a>
          </nav>
          <hr>
          <nav class="nav">
            <a href=""><i class="ri-question-line"></i> Help Center</a>
            <a href=""><i class="ri-lock-line"></i> Privacy Settings</a>
            <a href=""><i class="ri-user-settings-line"></i> Account Settings</a>
            <a href=""><i class="ri-logout-box-r-line"></i> Log Out</a>
          </nav>
        </div><!-- dropdown-menu-body -->
      </div><!-- dropdown-menu -->
    </div><!-- dropdown -->
  </div><!-- header-main -->

  <div class="main main-calendar">
    <div class="calendar-sidebar">
      <div id="calSidebar" class="sidebar-body">
        <div class="d-grid mb-3">
          <a id="btnCreateEvent" href="" class="btn btn-primary">Crear nueva reserva</a>
        </div>
        <div id="datepicker1" class="task-calendar mb-5"></div>

        <nav class="nav nav-calendar mb-4">
          <a href="" class="nav-link discover"><span></span> Confirmadas</a>
          <a href="" class="nav-link meetup"><span></span> Pendientes</a>
          <a href="" class="nav-link holiday"><span></span> Finalizadas</a>
        </nav>
      </div><!-- sidebar-body -->
    </div><!-- calendar-sidebar -->
    <div id="calendar" class="calendar-body"></div>
  </div><!-- main -->

  <div class="modal modal-event fade" id="modalCreateEvent" tabindex="-1" aria-labelledby="modalLabelCreateEvent"
    aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">

        <div class="modal-header">
          <h5 class="modal-title" id="modalLabelCreateEvent">Nueva reserva</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div><!-- modal-header -->

        <div class="modal-body">

          <div class="g-3 mb-3 row">
            <div class="col-md-2 col-3">
              <label class="form-label">Asistentes:</label>
              <input id="asistentes" name="asistentes" type="number" class="form-control " placeholder="#" min="1">
            </div>
          </div>

          <div class="g-3 mb-3 row">
            <div class="col-md-5 col-7">
              <label class="form-label">Fecha:</label>
              <input id="fecha" name="fecha" type="date" class="form-control" placeholder="Escoge una fecha">
            </div><!-- col -->

            <div class="col">
              <label class="form-label">Inicio:</label>
              <select id="horaInicio" name="horaInicio" class="form-select">
                <option>Hora...</option>
              </select>
            </div><!-- col -->

            <div class="col">
              <label class="form-label">Finalización:</label>
              <select id="horaFin" name="horaFin" class="form-select">
                <option>Hora</option>
              </select>
            </div><!-- col -->

          </div><!-- row -->

          <div class="mb-3">
            <div class="col-md-3 col-3">
              <label class="form-label">Total:</label>
              <input id="total" name="total" type="text" class="form-control" placeholder="Automático" disabled>
            </div>
          </div>
        </div><!-- modal-body -->

        <div class="modal-footer">
          <button id="btnGuardar" type="button" class="btn btn-primary">Guardar</button>
        </div><!-- modal-footer -->

      </div><!-- modal-content -->
    </div><!-- modal-dialog -->
  </div><!-- modal -->

  <script src="../lib/jquery/jquery.min.js"></script>
  <script src="../lib/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="../lib/perfect-scrollbar/perfect-scrollbar.min.js"></script>
  <script src="../lib/jqueryui/jquery-ui.min.js"></script>
  <script src="../lib/moment/moment.min.js"></script>
  <script src="../lib/fullcalendar/main.min.js"></script>

  <script src="../assets/js/script.js"></script>
  <script src="../assets/js/calendar-events.js"></script>
  <script src="../assets/js/calendar.js"></script>

  <script>
    'use script'


  </script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const stripe = Stripe('pk_live_51PyhP5KJQTnSHL1ZgCd4aiOMCm8i7w6EKzBzf2XsYUvAoSiUdHGbGrJT9myaYySsj2hNtSvNGyZZsJMGp941azbt003Rs2iw1X');
      const hourOptions = ['08:00', '08:30', '09:00', '09:30', '10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '13:00', '13:30', '14:00', '14:30', '15:00', '15:30', '16:00', '16:30', '17:00', '17:30', '18:00', '18:30', '19:00', '19:30', '20:00', '20:30', '21:00', '21:30', '22:00', '22:30', '23:00'];
      const btnGuardar = document.getElementById('btnGuardar');
      const fechaInput = document.getElementById('fecha');
      const horaInicioSelect = document.getElementById('horaInicio');
      const horaFinSelect = document.getElementById('horaFin');
      const totalInput = document.getElementById('total');

      let clientSecret = '';

      // Cargar las opciones de horas de inicio
      hourOptions.forEach(hour => {
        const option = document.createElement('option');
        option.value = hour;
        option.textContent = hour;
        horaInicioSelect.appendChild(option);
      });

      // Manejar el cambio de hora de inicio
      horaInicioSelect.addEventListener('change', function () {
        const startHour = this.value;
        horaFinSelect.innerHTML = '<option>Hora</option>';
        let [hour, minutes] = startHour.split(':');
        hour = parseInt(hour);
        minutes = parseInt(minutes);

        // Generar opciones de fin: 1 hora, 1.5 horas y 2 horas
        for (let i = 1; i <= 2; i += 0.5) {
          const endHour = hour + Math.floor(i);
          const endMinutes = (minutes + (i % 1) * 60) % 60;
          const formattedMinutes = endMinutes === 0 ? '00' : endMinutes.toString().padStart(2, '0');
          const formattedHour = endHour < 10 ? `0${endHour}` : endHour;

          const option = document.createElement('option');
          option.value = `${formattedHour}:${formattedMinutes}`;
          option.textContent = `${formattedHour}:${formattedMinutes}`;
          horaFinSelect.appendChild(option);
        }
      });

      // Manejar el cambio de hora de finalización y actualizar el total
      horaFinSelect.addEventListener('change', function () {
        const selectedIndex = horaFinSelect.selectedIndex;
        updateTotal(selectedIndex);
      });

      // Actualiza el valor del total basado en la selección del índice de la hora de finalización
      function updateTotal(index) {
        let totalValue;
        switch (index) {
          case 1:
            totalValue = 500; // 1 hora
            break;
          case 2:
            totalValue = 650; // 1.5 horas
            break;
          case 3:
            totalValue = 800; // 2 horas
            break;
          default:
            totalValue = 0;
            break;
        }
        totalInput.value = totalValue;
      }

      // Manejar el clic en el botón de guardar
      btnGuardar.addEventListener('click', async function () {
        const asistentes = document.getElementById('asistentes').value;
        const fecha = fechaInput.value;
        const inicio = horaInicioSelect.value;
        const finalizacion = horaFinSelect.value;
        const total = totalInput.value;

        if (!fecha || !inicio || !finalizacion) {
          alert('Por favor, complete todos los campos.');
          return;
        }

        const userCookie = getCookie('user');
        if (!userCookie) {
          alert('Error: No se encontró la cookie de usuario. Por favor, inicia sesión.');
          return;
        }

        let userData;
        try {
          // Decodificar el valor de la cookie antes de parsear
          const decodedCookie = decodeURIComponent(userCookie);
          console.log('Cookie decodificada:', decodedCookie); // Para verificar el valor decodificado
          userData = JSON.parse(decodedCookie);
        } catch (error) {
          alert('Error: La cookie de usuario no tiene un formato válido.');
          console.error('Error al parsear la cookie de usuario:', error);
          return;
        }

        if (!userData.token) {
          alert('Error: La cookie de usuario no contiene un token válido.');
          return;
        }

        const reserva = {
          token: userData.token,
          cliente: JSON.stringify(userData),
          numero_asistentes: asistentes,
          fecha: fecha,
          inicio: inicio,
          finalizacion: finalizacion,
          total: total,
        };

        try {
          const response = await fetch('https://fut7montessori.com.mx/dist/model/reserva.php', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/x-www-form-urlencoded'
            },
            body: new URLSearchParams(reserva)
          });

          const result = await response.json();
          if (result.status === "Horario no disponible") {
            alert('Horario no disponible');
            return;
          }

          clientSecret = result.status;
          console.log('Reserva creada con éxito:', result);
        } catch (error) {
          console.error('Error al guardar la reserva:', error);
        }
      });

      // Función para obtener la cookie por nombre
      function getCookie(name) {
        const nameEQ = name + "=";
        const ca = document.cookie.split(';');
        for (let i = 0; i < ca.length; i++) {
          let c = ca[i];
          while (c.charAt(0) === ' ') c = c.substring(1, c.length);
          if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
      }
    });


  </script>
</body>

</html>